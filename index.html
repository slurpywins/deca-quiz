<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DECA Finance Quiz</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --primary: #4f46e5; --bg: #f9fafb; --card: #ffffff; --text: #1f2937; --text-light: #6b7280; --border: #e5e7eb; --radius: 0.5rem; --transition: 0.2s; }
    * { box-sizing: border-box; margin:0; padding:0; }
    body { background: var(--bg); font-family: 'Inter', sans-serif; color: var(--text); }
    #auth-ui, .quiz-container, #result { max-width:700px; margin:2rem auto; padding:1rem; background: var(--card); border:1px solid var(--border); border-radius:var(--radius); box-shadow:0 4px 8px rgba(0,0,0,0.05); }
    #auth-ui input { width:100%; padding:0.75rem; margin-bottom:0.75rem; border:1px solid var(--border); border-radius:var(--radius); }
    #auth-ui button { width:48%; margin:0.25rem 1%; padding:0.75rem; border:none; border-radius:var(--radius); background:var(--primary); color:#fff; font-weight:600; cursor:pointer; }
    #auth-ui button#btnLogout { background:#dc2626; }
    .quiz-container { display:none; padding:2rem; }
    h1 { text-align:center; color:var(--primary); margin-bottom:0.5rem; font-weight:600; }
    .timer { text-align:center; font-size:1rem; color: var(--text); margin-bottom:1rem; }
    .timer span { font-weight:600; color: var(--primary); }
    .progress { font-size:0.9rem; color:var(--text-light); margin-bottom:1rem; }
    .progress-bar { width:100%; height:6px; background:var(--border); border-radius:var(--radius); overflow:hidden; margin-bottom:1.5rem; }
    .bar { height:100%; background:var(--primary); width:0; transition: width var(--transition); }
    #question { font-size:1.1rem; margin-bottom:1rem; }
    .choices { list-style:none; padding:0; margin:0; }
    .choices li { margin-bottom:0.75rem; }
    .choices label { display:flex; align-items:center; cursor:pointer; padding:0.6rem 1rem; border:1px solid var(--border); border-radius:var(--radius); transition:background var(--transition),border-color var(--transition); }
    .choices input { margin-right:0.8rem; accent-color:var(--primary); }
    .choices label:hover { background:var(--bg); border-color:var(--primary); }
    .nav { display:flex; justify-content:space-between; margin-top:1.5rem; }
    .nav button { background:var(--primary); color:white; border:none; padding:0.75rem 1.5rem; border-radius:var(--radius); cursor:pointer; transition:background var(--transition); font-weight:600; }
    .nav button:disabled { background:var(--border); cursor:default; }
    #result { display:none; text-align:center; margin-top:1rem; padding:2rem; }
    #result h2 { color:var(--primary); margin-bottom:1rem; }
    .review { text-align:left; margin-top:1rem; }
    .review p { margin-bottom:0.6rem; }
    .correct { color:#16a34a; }
    .incorrect { color:#dc2626; }
  </style>
</head>
<body>
  <div id="auth-ui">
    <h2>DECA Finance Quiz Login</h2>
    <input id="email"    type="email"    placeholder="Email">
    <input id="password" type="password" placeholder="Password">
    <div style="text-align:center;">
      <button id="btnSignUp">Sign Up</button>
      <button id="btnLogin">Log In</button>
      <button id="btnLogout" style="display:none;">Log Out</button>
    </div>
  </div>

  <div class="quiz-container">
    <h1>DECA Finance Quiz</h1>
    <div class="timer">Time Remaining: <span id="timer">60:00</span></div>
    <div class="progress">Question <span id="current">1</span> of <span id="total">100</span></div>
    <div class="progress-bar"><div class="bar" id="bar"></div></div>
    <div id="quiz">
      <div id="question"></div>
      <ul class="choices" id="choices"></ul>
      <div class="nav">
        <button id="prev">Previous</button>
        <button id="next">Next</button>
      </div>
    </div>
  </div>

  <div id="result">
    <h2>Your Score: <span id="score"></span></h2>
    <div class="review" id="review"></div>
  </div>

  <!-- Quiz & Timer Logic -->
  <script>
    // Firebase variables (initialized later)
    let auth, db;

    // Quiz data and state
    let questions = [ /* ... all 100 questions ... */ ];
    const total = questions.length;
    let current = 0;
    const answers = Array(total).fill(null);

    // DOM refs
    const authUI     = document.getElementById('auth-ui');
    const emailInput    = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const btnSignUp  = document.getElementById('btnSignUp');
    const btnLogin   = document.getElementById('btnLogin');
    const btnLogout  = document.getElementById('btnLogout');

    const quizCon    = document.querySelector('.quiz-container');
    const questionEl = document.getElementById('question');
    const choicesEl  = document.getElementById('choices');
    const prevBtn    = document.getElementById('prev');
    const nextBtn    = document.getElementById('next');
    const currentEl  = document.getElementById('current');
    const totalEl    = document.getElementById('total');
    const barEl      = document.getElementById('bar');

    const resultEl   = document.getElementById('result');
    const scoreEl    = document.getElementById('score');
    const reviewEl   = document.getElementById('review');

    // Timer setup
    const totalTime = 60 * 60;
    let timeLeft    = totalTime;
    let timerInterval;
    function startTimer(uid) {
      document.getElementById('timer').textContent = formatTime(timeLeft);
      timerInterval = setInterval(async () => {
        timeLeft--;
        document.getElementById('timer').textContent = formatTime(timeLeft);
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          await saveProgress(uid);
          showResults();
        }
      }, 1000);
    }
    function formatTime(sec) {
      const m=String(Math.floor(sec/60)).padStart(2,'0');
      const s=String(sec%60).padStart(2,'0');
      return `${m}:${s}`;
    }

    // Render question
    function render() {
      totalEl.textContent   = total;
      currentEl.textContent = current+1;
      barEl.style.width     = ((current+1)/total*100) + '%';
      const q = questions[current];
      questionEl.textContent = q.question;
      choicesEl.innerHTML    = '';
      q.choices.forEach((c,i) => {
        const li = document.createElement('li');
        li.innerHTML = `<label><input type="radio" name="choice" value="${i}" ${answers[current]===i?'checked':''} /> ${c}</label>`;
        choicesEl.appendChild(li);
      });
      prevBtn.disabled = current===0;
      nextBtn.textContent = current===total-1 ? 'Submit' : 'Next';
    }

    // Save/load with Firestore
    async function saveProgress(uid) {
      await db.collection('progress').doc(uid).set({ answers, current, timeLeft }, { merge:true });
    }
    async function loadProgress(uid) {
      const doc = await db.collection('progress').doc(uid).get();
      if (doc.exists) {
        const data = doc.data();
        Object.assign(answers, data.answers);
        current = data.current;
        timeLeft = data.timeLeft || totalTime;
      }
      render();
      startTimer(uid);
    }

    // Show results
    function showResults() {
      quizCon.style.display   = 'none';
      resultEl.style.display  = 'block';
      let score = answers.reduce((sum,a,i) => sum + (a===questions[i].correct), 0);
      scoreEl.textContent = `${score}/${total}`;
      reviewEl.innerHTML = '';
      questions.forEach((q,i) => {
        if (answers[i] !== q.correct) {
          const p = document.createElement('p');
          p.innerHTML = `Q${i+1}: Correct is <strong>${q.choices[q.correct]}</strong>`;
          reviewEl.appendChild(p);
        }
      });
    }

    // Event listeners
    choicesEl.addEventListener('change', async e => {
      answers[current] = +e.target.value;
      const user = auth.currentUser;
      if (user) await saveProgress(user.uid);
    });
    prevBtn.addEventListener('click', async () => {
      if (current>0) {
        current--;
        render();
        await saveProgress(auth.currentUser.uid);
      }
    });
    nextBtn.addEventListener('click', async () => {
      if (current < total-1) {
        current++;
        render();
        await saveProgress(auth.currentUser.uid);
      } else {
        clearInterval(timerInterval);
        await saveProgress(auth.currentUser.uid);
        showResults();
      }
    });

    // Firebase auth and Firestore initialization (compat SDK)
  </script>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
  apiKey: "AIzaSyAEJU8ZOlOuQzMNw7Cza-U_SuegJH29jRo",
  authDomain: "deca-55fc4.firebaseapp.com",
  projectId: "deca-55fc4",
  storageBucket: "deca-55fc4.firebasestorage.app",
  messagingSenderId: "368623997898",
  appId: "1:368623997898:web:79b9952ee9e9fa0edb7533",
  measurementId: "G-7ZT1H2WTWH"
    };
    firebase.initializeApp(firebaseConfig);
    auth = firebase.auth();
    db   = firebase.firestore();

    // Hook up auth UI
    btnSignUp.onclick = async () => {
      await auth.createUserWithEmailAndPassword(email.value, password.value);
    };
    btnLogin.onclick = async () => {
      await auth.signInWithEmailAndPassword(email.value, password.value);
    };
    btnLogout.onclick = () => auth.signOut();

    auth.onAuthStateChanged(user => {
      if (user) {
        authUI.style.display = 'none';
        btnLogout.style.display = 'inline-block';
        quizCon.style.display = 'block';
        resultEl.style.display = 'none';
        loadProgress(user.uid);
      } else {
        authUI.style.display = 'block';
        btnLogout.style.display = 'none';
        quizCon.style.display = 'none';
        resultEl.style.display = 'none';
      }
    });
  </script>
</body>
</html>
