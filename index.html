<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DECA Finance Quiz</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --primary: #4f46e5; --bg: #f9fafb; --card: #fff; --text: #1f2937; --light: #6b7280; --border: #e5e7eb; --radius: .5rem; }
    * { box-sizing: border-box; margin:0; padding:0; }
    body { background: var(--bg); font-family: 'Inter', sans-serif; color: var(--text); }
    #auth-ui, #home-screen, .quiz-container, #result { max-width:700px; margin:2rem auto; padding:1rem; background: var(--card); border:1px solid var(--border); border-radius:var(--radius); box-shadow:0 4px 8px rgba(0,0,0,0.05); }
    #auth-ui input { width:100%; padding:.75rem; margin-bottom:.75rem; border:1px solid var(--border); border-radius:var(--radius); }
    #auth-ui button { width:48%; margin:.25rem 1%; padding:.75rem; border:none; border-radius:var(--radius); background:var(--primary); color:#fff; font-weight:600; cursor:pointer; }
    #auth-ui button#btnLogout { background:#dc2626; }
    #home-screen { display:none; text-align:center; }
    #home-screen h2 { margin-bottom:1rem; color:var(--primary); }
    #home-screen .home-buttons { display:flex; gap:1rem; justify-content:center; margin-bottom:1rem; }
    #home-screen button { flex:1; padding:1rem; border:none; border-radius:var(--radius); cursor:pointer; font-weight:600; }
    #btnResume { background:#4f46e5; color:#fff; }
    #btnStartNew { background:#10b981; color:#fff; }
    #btnLogoutHome { background:#dc2626; color:#fff; margin-top:1rem; }
    .quiz-container { display:none; padding:2rem; }
    h1 { text-align:center; color:var(--primary); margin-bottom:.5rem; }
    .timer { text-align:center; margin-bottom:1rem; }
    .timer span { font-weight:600; color:var(--primary); }
    .progress { margin-bottom:1rem; color:var(--light); }
    .progress-bar { width:100%; height:6px; background:var(--border); border-radius:var(--radius); overflow:hidden; margin-bottom:1.5rem; }
    .bar { height:100%; background:var(--primary); width:0; transition: width .2s; }
    #question { margin-bottom:1rem; font-size:1.1rem; }
    .choices { list-style:none; padding:0; }
    .choices li { margin-bottom:.75rem; }
    .choices label { display:flex; align-items:center; padding:.6rem 1rem; border:1px solid var(--border); border-radius:var(--radius); cursor:pointer; transition:background .2s, border-color .2s; }
    .choices input { margin-right:.8rem; accent-color:var(--primary); }
    .choices label:hover { background:var(--bg); border-color:var(--primary); }
    .nav { display:flex; justify-content:space-between; margin-top:1.5rem; }
    .nav button { background:var(--primary); color:#fff; border:none; padding:.75rem 1.5rem; border-radius:var(--radius); cursor:pointer; font-weight:600; }
    .nav button:disabled { background:var(--border); cursor:default; }
    #result { display:none; text-align:center; margin-top:1rem; }
    #result h2 { color:var(--primary); margin-bottom:1rem; }
    .review { text-align:left; }
    .review p { margin-bottom:.6rem; }
    .correct { color:#16a34a; }
    .incorrect { color:#dc2626; }
  </style>
</head>
<body>
  <!-- Auth UI -->
  <div id="auth-ui">
    <h2>DECA Finance Quiz Login</h2>
    <input id="email"    type="email"    placeholder="Email">
    <input id="password" type="password" placeholder="Password">
    <div style="text-align:center;">
      <button id="btnSignUp">Sign Up</button>
      <button id="btnLogin">Log In</button>
      <button id="btnLogout" style="display:none;">Log Out</button>
    </div>
  </div>

  <!-- Home Screen -->
  <div id="home-screen">
    <h2>Welcome!</h2>
    <div class="home-buttons">
      <button id="btnResume">Resume Test</button>
      <button id="btnStartNew">Start New Test</button>
    </div>
    <button id="btnLogoutHome">Log Out</button>
  </div>

  <!-- Quiz -->
  <div class="quiz-container">
    <h1>DECA Finance Quiz</h1>
    <div class="timer">Time Remaining: <span id="timer">60:00</span></div>
    <div class="progress">Question <span id="current">1</span> of <span id="total">100</span></div>
    <div class="progress-bar"><div class="bar" id="bar"></div></div>
    <div id="quiz">
      <div id="question"></div>
      <ul class="choices" id="choices"></ul>
      <div class="nav">
        <button id="prev">Previous</button>
        <button id="next">Next</button>
      </div>
    </div>
  </div>

  <!-- Results -->
  <div id="result">
    <h2>Your Score: <span id="score"></span></h2>
    <div class="review" id="review"></div>
  </div>

  <!-- Main Logic -->
  <script>
    let auth, db;
    const questions = [
      // … insert all 100 question objects here with {question, choices:[…], correct:…}
    ];
    const total = questions.length;
    let current = 0, timeLeft = 60*60;
    const answers = Array(total).fill(null);
    const qEls = {
      authUI:    document.getElementById('auth-ui'),
      home:      document.getElementById('home-screen'),
      quiz:      document.querySelector('.quiz-container'),
      result:    document.getElementById('result'),
      email:     document.getElementById('email'),
      password:  document.getElementById('password'),
      btnSU:     document.getElementById('btnSignUp'),
      btnLI:     document.getElementById('btnLogin'),
      btnLO:     document.getElementById('btnLogout'),
      btnR:      document.getElementById('btnResume'),
      btnN:      document.getElementById('btnStartNew'),
      btnLH:     document.getElementById('btnLogoutHome'),
      question:  document.getElementById('question'),
      choices:   document.getElementById('choices'),
      prev:      document.getElementById('prev'),
      next:      document.getElementById('next'),
      curr:      document.getElementById('current'),
      tot:       document.getElementById('total'),
      bar:       document.getElementById('bar'),
      timer:     document.getElementById('timer'),
      score:     document.getElementById('score'),
      review:    document.getElementById('review')
    };

    function fmt(sec) {
      const m=String(Math.floor(sec/60)).padStart(2,'0');
      const s=String(sec%60).padStart(2,'0');
      return `${m}:${s}`;
    }

    async function saveP(uid){
      await db.collection('progress').doc(uid).set({answers,current,timeLeft},{merge:true});
    }
    async function loadP(uid){
      const doc = await db.collection('progress').doc(uid).get();
      if(doc.exists){
        const d=doc.data();
        Object.assign(answers,d.answers);
        current=d.current; timeLeft=d.timeLeft||60*60;
      }
      render(); startT(uid);
    }

    function startT(uid){
      qEls.timer.textContent=fmt(timeLeft);
      const iv = setInterval(async()=>{
        timeLeft--; qEls.timer.textContent=fmt(timeLeft);
        if(timeLeft<=0){ clearInterval(iv); await saveP(uid); showR(); }
      },1000);
    }

    function showR(){
      qEls.quiz.style.display=qEls.home.style.display='none';
      qEls.result.style.display='block';
      let sc=answers.reduce((sum,a,i)=>sum+(a===questions[i].correct),0);
      qEls.score.textContent=`${sc}/${total}`;
      qEls.review.innerHTML='';
      questions.forEach((q,i)=>{
        if(answers[i]!==q.correct){
          const p=document.createElement('p');
          p.innerHTML=`Q${i+1}: Correct is <strong>${q.choices[q.correct]}</strong>`;
          qEls.review.appendChild(p);
        }
      });
    }

    function render(){
      qEls.tot.textContent=total;
      qEls.curr.textContent=current+1;
      qEls.bar.style.width=`${(current+1)/total*100}%`;
      const q=questions[current];
      qEls.question.textContent=q.question;
      qEls.choices.innerHTML='';
      q.choices.forEach((c,i)=>{
        const li=document.createElement('li');
        li.innerHTML=`<label><input type="radio" name="c" value="${i}" ${answers[current]===i?'checked':''}/> ${c}</label>`;
        qEls.choices.appendChild(li);
      });
      qEls.prev.disabled=current===0;
      qEls.next.textContent=current===total-1?'Submit':'Next';
    }

    // Nav listeners
    qEls.choices.addEventListener('change',async e=>{
      answers[current]=+e.target.value;
      if(auth.currentUser) await saveP(auth.currentUser.uid);
    });
    qEls.prev.addEventListener('click',async()=>{
      if(current>0){ current--; render(); await saveP(auth.currentUser.uid); }
    });
    qEls.next.addEventListener('click',async()=>{
      if(current<total-1){ current++; render(); await saveP(auth.currentUser.uid); }
      else { await saveP(auth.currentUser.uid); showR(); }
    });
    qEls.btnR.onclick =()=>{ qEls.home.style.display='none'; qEls.quiz.style.display='block'; loadP(auth.currentUser.uid); };
    qEls.btnN.onclick=async()=>{
      answers.fill(null); current=0; timeLeft=60*60;
      await saveP(auth.currentUser.uid);
      qEls.home.style.display='none';
      qEls.quiz.style.display='block';
      render(); startT(auth.currentUser.uid);
    };
    qEls.btnLH.onclick=()=> auth.signOut();

    // Firebase SDKs & init
  </script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    const cfg = {
      apiKey:    "AIzaSyAEJU8ZOlOuQzMNw7Cza-U_SuegJH29jRo",
      authDomain:"deca-55fc4.firebaseapp.com",
      projectId: "deca-55fc4",
      storageBucket:"deca-55fc4.appspot.com",
      messagingSenderId:"368623997898",
      appId:"1:368623997898:web:79b9952ee9e9fa0edb7533",
      measurementId:"G-7ZT1H2WTWH"
    };
    firebase.initializeApp(cfg);
    auth = firebase.auth();
    db   = firebase.firestore();

    qEls.btnSU.onclick =async()=>{ try{await auth.createUserWithEmailAndPassword(qEls.email.value,qEls.password.value);}catch(e){alert(e.message);} };
    qEls.btnLI.onclick =async()=>{ try{await auth.signInWithEmailAndPassword(qEls.email.value,qEls.password.value);}catch(e){alert(e.message);} };
    qEls.btnLO.onclick =()=> auth.signOut();

    auth.onAuthStateChanged(u=>{
      if(u){
        qEls.authUI.style.display='none';
        qEls.home.style.display='block';
        qEls.quiz.style.display='none';
        qEls.result.style.display='none';
      } else {
        qEls.authUI.style.display='block';
        qEls.home.style.display='none';
        qEls.quiz.style.display='none';
        qEls.result.style.display='none';
      }
    });
  </script>
</body>
</html>
